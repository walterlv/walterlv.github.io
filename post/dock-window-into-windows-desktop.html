<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="天前"><meta name="hour-prompt" content="小时前"><meta name="minute-prompt" content="分钟前"><meta name="justnow-prompt" content="刚刚"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性）" /><meta name="author" content="吕毅" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="本文介绍如何使用 Windows 的 AppBar 相关 API 实现固定停靠在桌面上的特殊窗口。" /><meta property="og:description" content="本文介绍如何使用 Windows 的 AppBar 相关 API 实现固定停靠在桌面上的特殊窗口。" /><link rel="canonical" href="https://blog.walterlv.com/post/dock-window-into-windows-desktop.html" /><meta property="og:url" content="https://blog.walterlv.com/post/dock-window-into-windows-desktop.html" /><meta property="og:site_name" content="walterlv" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-05-23T18:53:39+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性）" /><meta name="twitter:site" content="@_lvyi_" /><meta name="twitter:creator" content="@吕毅" /> <script type="application/ld+json"> {"datePublished":"2019-05-23T18:53:39+08:00","description":"本文介绍如何使用 Windows 的 AppBar 相关 API 实现固定停靠在桌面上的特殊窗口。","dateModified":"2021-12-20T00:40:29+08:00","headline":"WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性）","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.walterlv.com/post/dock-window-into-windows-desktop.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.walterlv.com/assets/img/logo.png"},"name":"吕毅"},"url":"https://blog.walterlv.com/post/dock-window-into-windows-desktop.html","author":{"@type":"Person","name":"吕毅"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性） - walterlv</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="walterlv"><meta name="application-name" content="walterlv"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="page-bluring-bg" style=" background-image: url('/static/posts/2019-05-22-16-57-28.png'); "></div><div id="topbar-wrapper" class="row topbar-down"><div id="topbar" class="col-12 d-flex h-100 align-items-center"><div id="topbar-logoside" class="col"> <a id="topbar-logo" href="https://blog.walterlv.com" alt="avatar"> <img src="/assets/img/logo.png" alt="avatar" onerror="this.style.display='none'"> </a> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i> <a id="topbar-title" class="site-title" href="https://blog.walterlv.com" alt="walterlv"> walterlv </a></div><div id="topbar-searchside" class="justify-content-center col-5"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >取消</span></div><div class="col"></div></div></div><div id="sidebar" class="d-flex flex-column align-items-end" lang="zh-CN"><div class="sidebar-box post-item-box profile-wrapper text-center"><div class="site-title mt-3"> <a href="/">吕毅</a></div><div class="site-subtitle font-italic">.NET and Windows App Developer, Microsoft MVP</div></div><ul class="sidebar-box post-item-box"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/friends/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>朋友和收藏</span> </a><li class="nav-item"> <a href="/mind/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>胡思乱想</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/walterlv" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_lvyi_" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['walter.lv','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性）</h1><div class="post-meta text-muted"><div class="d-flex"> <span> 吕毅 </span> <span> 发表于 <em class="timeago" date="2019-05-22 19:57:43 +0800" data-toggle="tooltip" data-placement="bottom" title="2019-05-22, 19:57 +0800" >2019-05-22</em> </span> <span> 更新于 <em class="timeago" date="2019-05-23 18:53:39 +0800" data-toggle="tooltip" data-placement="bottom" title="2019-05-23, 18:53 +0800" >2019-05-23</em> </span></div></div><div class="post-content"><p>本文介绍如何使用 Windows 的 AppBar 相关 API 实现固定停靠在桌面上的特殊窗口。</p><hr /><div id="toc"></div><h2 id="停靠窗口">停靠窗口<a href="#停靠窗口"><i class="fas fa-hashtag"></i></a></h2></h2><p>你可能并不明白停靠窗口是什么意思。</p><p>看下图，你可能使用过 OneNote 的停靠窗口功能。当打开一个新的 OneNote 停靠窗口之后，这个新的 OneNote 窗口将固定显示在桌面的右侧，其他的窗口就算最大化也只会占据剩余的空间。</p><p>OneNote 的这种功能可以让你在一边浏览网页或做其他事情的时候，以便能够做笔记。同时又不用担心其他窗口最大化的时候会占据记笔记的一部分空间。</p><p><img data-proofer-ignore data-src="/static/posts/2019-05-22-16-57-28.png" alt="OneNote 的停靠窗口" /></p><p>这其实也是 Windows 任务栏所使用的方法。</p><p>OneNote 中给出的名称叫做“停靠窗口”，于是这可以代表微软希望用户对这个概念的理解名词。</p><p>只是，这个概念在 Windows API 中的名称叫做 AppBar。</p><h2 id="appbar">AppBar<a href="#appbar"><i class="fas fa-hashtag"></i></a></h2></h2><p>要做出停靠窗口的效果，最核心的 API 是 <code class="language-plaintext highlighter-rouge">SHAppBarMessage</code>，用于发送 AppBar 消息给操作系统，以便让操作系统开始处理此窗口已形成一个 AppBar 窗口。也就是我们在用户交互上所说的“停靠窗口”。</p><p>虽然说要让一个窗口变成 AppBar 只需要一点点代码，但是要让整个停靠窗口工作得真的像一个停靠窗口，依然需要大量的辅助代码。所以我将其封装成了一个 <code class="language-plaintext highlighter-rouge">DesktopAppBar</code> 类，方便 WPF 程序来调用。</p><h2 id="如何使用">如何使用<a href="#如何使用"><i class="fas fa-hashtag"></i></a></h2></h2><p>以下使用，你需要先获取我封装的源码才可以编译通过：</p><ul><li><a href="https://gist.github.com/walterlv/1169952f73f44a8623bbbf7e1ca1a342">https://gist.github.com/walterlv/1169952f73f44a8623bbbf7e1ca1a342</a></ul><p>你可以在 XAML 中使用：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nt">&lt;Window</span> <span class="na">x:Class=</span><span class="s">"Walterlv.Demo.DesktopDocking.MainWindow"</span>
        <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
        <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
        <span class="na">xmlns:dock=</span><span class="s">"clr-namespace:Walterlv.Demo.DesktopDocking"</span>
        <span class="na">mc:Ignorable=</span><span class="s">"d"</span> <span class="na">Title=</span><span class="s">"Walterlv 的停靠窗口"</span> <span class="na">Height=</span><span class="s">"450"</span> <span class="na">Width=</span><span class="s">"500"</span>
        <span class="na">dock:DesktopAppBar.AppBar=</span><span class="s">"Right"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;StackPanel</span> <span class="na">Background=</span><span class="s">"#ffcd42"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;TextBlock</span> <span class="na">FontSize=</span><span class="s">"64"</span> <span class="na">Margin=</span><span class="s">"64"</span> <span class="na">TextAlignment=</span><span class="s">"Center"</span> <span class="na">Text=</span><span class="s">"walterlv 的停靠窗口"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;Button</span> <span class="na">Content=</span><span class="s">"再停靠一个 - blog.walterlv.com"</span> <span class="na">FontSize=</span><span class="s">"32"</span> <span class="na">Padding=</span><span class="s">"32"</span> <span class="na">Margin=</span><span class="s">"32"</span> <span class="na">Background=</span><span class="s">"#f9d77b"</span> <span class="na">BorderThickness=</span><span class="s">"0"</span>
                <span class="na">Click=</span><span class="s">"Button_Click"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/StackPanel&gt;</span>
<span class="nt">&lt;/Window&gt;</span>
</pre></table></code></div></div><p>核心代码是其中的一处属性赋值 <code class="language-plaintext highlighter-rouge">dock:DesktopAppBar.AppBar="Right"</code>，以及前面的命名空间声明 <code class="language-plaintext highlighter-rouge">xmlns:dock="clr-namespace:Walterlv.Demo.DesktopDocking"</code>。</p><p>你也可以在 C# 代码中使用：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Walterlv.Demo.DesktopDocking</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainWindow</span> <span class="p">:</span> <span class="n">Window</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">MainWindow</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitializeComponent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnSourceInitialized</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">base</span><span class="p">.</span><span class="nf">OnSourceInitialized</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
            <span class="n">DesktopAppBar</span><span class="p">.</span><span class="nf">SetAppBar</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Right</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>使用以上代码中的任何一种方式，你就可以让你的窗口在右边停靠了。</p><p><img data-proofer-ignore data-src="/static/posts/2019-05-22-19-29-33.png" alt="停靠的窗口" /></p><p>从图中我们可以发现，我们的示例窗口停靠在了右边，其宽度就是我们在 XAML 中设置的窗口宽度（当然这是我封装的逻辑，而不是 AppBar 的原生逻辑）。</p><p>同时我们还能注意到，Visual Studio 的窗口是处于最大化的状态的——这是停靠窗口的最大优势——可以让其他窗口的工作区缩小，在最大化的时候不会覆盖到停靠窗口的内容。</p><p>另外，如果设置了第二个停靠窗口，那么第二个停靠窗口会挤下第一个窗口的位置。</p><p><img data-proofer-ignore data-src="/static/posts/2019-05-22-20-02-29.png" alt="两个停靠窗口" /></p><h2 id="如何还原">如何还原<a href="#如何还原"><i class="fas fa-hashtag"></i></a></h2></h2><p>Windows AppBar 的 API 有一个很不好的设定，如果进程退出了，那么 AppBar 所占用的空间 <strong>并不会还原</strong>！！！</p><p>不过不用担心，我在封装的代码里面加入了窗口关闭时还原空间的代码，如果你正常关闭窗口，那么停靠窗口占用的空间就会及时还原回来。</p><p>当然，你也可以适时调用下面的代码：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">DesktopAppBar</span><span class="p">.</span><span class="nf">SetAppBar</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="附源码">附源码<a href="#附源码"><i class="fas fa-hashtag"></i></a></h2></h2><p>由于源码一直在持续改进，所以本文中贴的源代码可能不是最新的。你可以在以下仓库找到这段源码的最新版本：</p><ul><li><a href="https://github.com/walterlv/walterlv.demo/tree/master/Walterlv.Demo.DesktopDocking/Walterlv.Demo.DesktopDocking">walterlv.demo/Walterlv.Demo.DesktopDocking/Walterlv.Demo.DesktopDocking at master · walterlv/walterlv.demo</a></ul><div class="language-csharp highlighter-rouge"><div class="code-header"> <span label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics.CodeAnalysis</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Interop</span><span class="p">;</span>

<span class="c1">// ReSharper disable IdentifierTypo</span>
<span class="c1">// ReSharper disable InconsistentNaming</span>
<span class="c1">// ReSharper disable EnumUnderlyingTypeIsInt</span>
<span class="c1">// ReSharper disable MemberCanBePrivate.Local</span>
<span class="c1">// ReSharper disable UnusedMember.Local</span>
<span class="c1">// ReSharper disable UnusedMember.Global</span>

<span class="k">namespace</span> <span class="nn">Walterlv.Demo.DesktopDocking</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 表示窗口停靠到桌面上时的边缘方向。</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">AppBarEdge</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 窗口停靠到桌面的左边。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Left</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 窗口停靠到桌面的顶部。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Top</span><span class="p">,</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 窗口停靠到桌面的右边。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Right</span><span class="p">,</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 窗口停靠到桌面的底部。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">Bottom</span><span class="p">,</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 窗口不停靠到任何方向，而是成为一个普通窗口占用剩余的可用空间（工作区）。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="n">None</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 提供将窗口停靠到桌面某个方向的能力。</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DesktopAppBar</span>
    <span class="p">{</span>
        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 标识 Window.AppBar 的附加属性。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">AppBarProperty</span> <span class="p">=</span> <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">RegisterAttached</span><span class="p">(</span>
            <span class="s">"AppBar"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">AppBarEdge</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">DesktopAppBar</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="n">AppBarEdge</span><span class="p">.</span><span class="n">None</span><span class="p">,</span> <span class="n">OnAppBarEdgeChanged</span><span class="p">));</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 获取 &lt;paramref name="window"/&gt; 当前的停靠边缘。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="window"&gt;要获取停靠边缘的窗口。&lt;/param&gt;</span>
        <span class="c1">/// &lt;returns&gt;停靠边缘。&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">AppBarEdge</span> <span class="nf">GetAppBar</span><span class="p">(</span><span class="n">Window</span> <span class="n">window</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">AppBarEdge</span><span class="p">)</span><span class="n">window</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">AppBarProperty</span><span class="p">);</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 设置 &lt;paramref name="window"/&gt; 的停靠边缘方向。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;param name="window"&gt;要设置停靠的窗口。&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name="value"&gt;要设置的停靠边缘方向。&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SetAppBar</span><span class="p">(</span><span class="n">Window</span> <span class="n">window</span><span class="p">,</span> <span class="n">AppBarEdge</span> <span class="k">value</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">window</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">AppBarProperty</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">DependencyProperty</span> <span class="n">AppBarProcessorProperty</span> <span class="p">=</span> <span class="n">DependencyProperty</span><span class="p">.</span><span class="nf">RegisterAttached</span><span class="p">(</span>
            <span class="s">"AppBarProcessor"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">AppBarWindowProcessor</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">DesktopAppBar</span><span class="p">),</span> <span class="k">new</span> <span class="nf">PropertyMetadata</span><span class="p">(</span><span class="k">null</span><span class="p">));</span>

        <span class="p">[</span><span class="nf">SuppressMessage</span><span class="p">(</span><span class="s">"ReSharper"</span><span class="p">,</span> <span class="s">"ConditionIsAlwaysTrueOrFalse"</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">OnAppBarEdgeChanged</span><span class="p">(</span><span class="n">DependencyObject</span> <span class="n">d</span><span class="p">,</span> <span class="n">DependencyPropertyChangedEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DesignerProperties</span><span class="p">.</span><span class="nf">GetIsInDesignMode</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">oldValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">AppBarEdge</span><span class="p">)</span> <span class="n">e</span><span class="p">.</span><span class="n">OldValue</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">newValue</span> <span class="p">=</span> <span class="p">(</span><span class="n">AppBarEdge</span><span class="p">)</span> <span class="n">e</span><span class="p">.</span><span class="n">NewValue</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">oldEnabled</span> <span class="p">=</span> <span class="n">oldValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Left</span>
                             <span class="p">||</span> <span class="n">oldValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Top</span>
                             <span class="p">||</span> <span class="n">oldValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Right</span>
                             <span class="p">||</span> <span class="n">oldValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">newEnabled</span> <span class="p">=</span> <span class="n">newValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Left</span>
                             <span class="p">||</span> <span class="n">newValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Top</span>
                             <span class="p">||</span> <span class="n">newValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Right</span>
                             <span class="p">||</span> <span class="n">newValue</span> <span class="k">is</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Bottom</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">oldEnabled</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">newEnabled</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">processor</span> <span class="p">=</span> <span class="p">(</span><span class="n">AppBarWindowProcessor</span><span class="p">)</span> <span class="n">d</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">AppBarProcessorProperty</span><span class="p">);</span>
                <span class="n">processor</span><span class="p">.</span><span class="nf">Detach</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(!</span><span class="n">oldEnabled</span> <span class="p">&amp;&amp;</span> <span class="n">newEnabled</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">processor</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AppBarWindowProcessor</span><span class="p">((</span><span class="n">Window</span><span class="p">)</span> <span class="n">d</span><span class="p">);</span>
                <span class="n">d</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">AppBarProcessorProperty</span><span class="p">,</span> <span class="n">processor</span><span class="p">);</span>
                <span class="n">processor</span><span class="p">.</span><span class="nf">Attach</span><span class="p">(</span><span class="n">newValue</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">oldEnabled</span> <span class="p">&amp;&amp;</span> <span class="n">newEnabled</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">processor</span> <span class="p">=</span> <span class="p">(</span><span class="n">AppBarWindowProcessor</span><span class="p">)</span> <span class="n">d</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="n">AppBarProcessorProperty</span><span class="p">);</span>
                <span class="n">processor</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">newValue</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// 包含对 &lt;see cref="Window"/&gt; 进行操作以便使其成为一个桌面停靠窗口的能力。</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">class</span> <span class="nc">AppBarWindowProcessor</span>
        <span class="p">{</span>
            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 创建 &lt;see cref="AppBarWindowProcessor"/&gt; 的新实例。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="c1">/// &lt;param name="window"&gt;需要成为停靠窗口的 &lt;see cref="Window"/&gt; 的实例。&lt;/param&gt;</span>
            <span class="k">public</span> <span class="nf">AppBarWindowProcessor</span><span class="p">(</span><span class="n">Window</span> <span class="n">window</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_window</span> <span class="p">=</span> <span class="n">window</span><span class="p">;</span>
                <span class="n">_callbackId</span> <span class="p">=</span> <span class="nf">RegisterWindowMessage</span><span class="p">(</span><span class="s">"AppBarMessage"</span><span class="p">);</span>
                <span class="n">_hwndSourceTask</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TaskCompletionSource</span><span class="p">&lt;</span><span class="n">HwndSource</span><span class="p">&gt;();</span>

                <span class="kt">var</span> <span class="n">source</span> <span class="p">=</span> <span class="p">(</span><span class="n">HwndSource</span><span class="p">)</span> <span class="n">PresentationSource</span><span class="p">.</span><span class="nf">FromVisual</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">source</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">window</span><span class="p">.</span><span class="n">SourceInitialized</span> <span class="p">+=</span> <span class="n">OnSourceInitialized</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">_hwndSourceTask</span><span class="p">.</span><span class="nf">SetResult</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="n">_window</span><span class="p">.</span><span class="n">Closed</span> <span class="p">+=</span> <span class="n">OnClosed</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">readonly</span> <span class="n">Window</span> <span class="n">_window</span><span class="p">;</span>
            <span class="k">private</span> <span class="k">readonly</span> <span class="n">TaskCompletionSource</span><span class="p">&lt;</span><span class="n">HwndSource</span><span class="p">&gt;</span> <span class="n">_hwndSourceTask</span><span class="p">;</span>
            <span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">_callbackId</span><span class="p">;</span>

            <span class="k">private</span> <span class="n">WindowStyle</span> <span class="n">_restoreStyle</span><span class="p">;</span>
            <span class="k">private</span> <span class="n">Rect</span> <span class="n">_restoreBounds</span><span class="p">;</span>
            <span class="k">private</span> <span class="n">ResizeMode</span> <span class="n">_restoreResizeMode</span><span class="p">;</span>
            <span class="k">private</span> <span class="kt">bool</span> <span class="n">_restoreTopmost</span><span class="p">;</span>

            <span class="k">private</span> <span class="n">AppBarEdge</span> <span class="n">Edge</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 在可以获取到窗口句柄的时候，给窗口句柄设置值。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="k">private</span> <span class="k">void</span> <span class="nf">OnSourceInitialized</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">SourceInitialized</span> <span class="p">-=</span> <span class="n">OnSourceInitialized</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">source</span> <span class="p">=</span> <span class="p">(</span><span class="n">HwndSource</span><span class="p">)</span> <span class="n">PresentationSource</span><span class="p">.</span><span class="nf">FromVisual</span><span class="p">(</span><span class="n">_window</span><span class="p">);</span>
                <span class="n">_hwndSourceTask</span><span class="p">.</span><span class="nf">SetResult</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 在窗口关闭之后，需要恢复窗口设置过的停靠属性。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="k">private</span> <span class="k">void</span> <span class="nf">OnClosed</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">Closed</span> <span class="p">-=</span> <span class="n">OnClosed</span><span class="p">;</span>
                <span class="n">_window</span><span class="p">.</span><span class="nf">ClearValue</span><span class="p">(</span><span class="n">AppBarProperty</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 将窗口属性设置为停靠所需的属性。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="k">private</span> <span class="k">void</span> <span class="nf">ForceWindowProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">WindowStyle</span> <span class="p">=</span> <span class="n">WindowStyle</span><span class="p">.</span><span class="n">None</span><span class="p">;</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">ResizeMode</span> <span class="p">=</span> <span class="n">ResizeMode</span><span class="p">.</span><span class="n">NoResize</span><span class="p">;</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">Topmost</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 备份窗口在成为停靠窗口之前的属性。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="k">private</span> <span class="k">void</span> <span class="nf">BackupWindowProperties</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">_restoreStyle</span> <span class="p">=</span> <span class="n">_window</span><span class="p">.</span><span class="n">WindowStyle</span><span class="p">;</span>
                <span class="n">_restoreBounds</span> <span class="p">=</span> <span class="n">_window</span><span class="p">.</span><span class="n">RestoreBounds</span><span class="p">;</span>
                <span class="n">_restoreResizeMode</span> <span class="p">=</span> <span class="n">_window</span><span class="p">.</span><span class="n">ResizeMode</span><span class="p">;</span>
                <span class="n">_restoreTopmost</span> <span class="p">=</span> <span class="n">_window</span><span class="p">.</span><span class="n">Topmost</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 使一个窗口开始成为桌面停靠窗口，并开始处理窗口停靠消息。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="c1">/// &lt;param name="value"&gt;停靠方向。&lt;/param&gt;</span>
            <span class="k">public</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">Attach</span><span class="p">(</span><span class="n">AppBarEdge</span> <span class="k">value</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">hwndSource</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_hwndSourceTask</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>

                <span class="nf">BackupWindowProperties</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">APPBARDATA</span><span class="p">();</span>
                <span class="n">data</span><span class="p">.</span><span class="n">cbSize</span> <span class="p">=</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
                <span class="n">data</span><span class="p">.</span><span class="n">hWnd</span> <span class="p">=</span> <span class="n">hwndSource</span><span class="p">.</span><span class="n">Handle</span><span class="p">;</span>

                <span class="n">data</span><span class="p">.</span><span class="n">uCallbackMessage</span> <span class="p">=</span> <span class="n">_callbackId</span><span class="p">;</span>
                <span class="nf">SHAppBarMessage</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">ABMsg</span><span class="p">.</span><span class="n">ABM_NEW</span><span class="p">,</span> <span class="k">ref</span> <span class="n">data</span><span class="p">);</span>
                <span class="n">hwndSource</span><span class="p">.</span><span class="nf">AddHook</span><span class="p">(</span><span class="n">WndProc</span><span class="p">);</span>

                <span class="nf">Update</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 更新一个窗口的停靠方向。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="c1">/// &lt;param name="value"&gt;停靠方向。&lt;/param&gt;</span>
            <span class="k">public</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="n">AppBarEdge</span> <span class="k">value</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">hwndSource</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_hwndSourceTask</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>

                <span class="n">Edge</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>


                <span class="kt">var</span> <span class="n">bounds</span> <span class="p">=</span> <span class="nf">TransformToAppBar</span><span class="p">(</span><span class="n">hwndSource</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span> <span class="n">_window</span><span class="p">.</span><span class="n">RestoreBounds</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>
                <span class="nf">ForceWindowProperties</span><span class="p">();</span>
                <span class="nf">Resize</span><span class="p">(</span><span class="n">_window</span><span class="p">,</span> <span class="n">bounds</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">/// &lt;summary&gt;</span>
            <span class="c1">/// 使一个窗口从桌面停靠窗口恢复成普通窗口。</span>
            <span class="c1">/// &lt;/summary&gt;</span>
            <span class="k">public</span> <span class="k">async</span> <span class="k">void</span> <span class="nf">Detach</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">hwndSource</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_hwndSourceTask</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>

                <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">APPBARDATA</span><span class="p">();</span>
                <span class="n">data</span><span class="p">.</span><span class="n">cbSize</span> <span class="p">=</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
                <span class="n">data</span><span class="p">.</span><span class="n">hWnd</span> <span class="p">=</span> <span class="n">hwndSource</span><span class="p">.</span><span class="n">Handle</span><span class="p">;</span>

                <span class="nf">SHAppBarMessage</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">ABMsg</span><span class="p">.</span><span class="n">ABM_REMOVE</span><span class="p">,</span> <span class="k">ref</span> <span class="n">data</span><span class="p">);</span>

                <span class="n">_window</span><span class="p">.</span><span class="n">WindowStyle</span> <span class="p">=</span> <span class="n">_restoreStyle</span><span class="p">;</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">ResizeMode</span> <span class="p">=</span> <span class="n">_restoreResizeMode</span><span class="p">;</span>
                <span class="n">_window</span><span class="p">.</span><span class="n">Topmost</span> <span class="p">=</span> <span class="n">_restoreTopmost</span><span class="p">;</span>

                <span class="nf">Resize</span><span class="p">(</span><span class="n">_window</span><span class="p">,</span> <span class="n">_restoreBounds</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="n">IntPtr</span> <span class="nf">WndProc</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hwnd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">msg</span><span class="p">,</span>
                <span class="n">IntPtr</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">bool</span> <span class="n">handled</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">msg</span> <span class="p">==</span> <span class="n">_callbackId</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">wParam</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">()</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">ABNotify</span><span class="p">.</span><span class="n">ABN_POSCHANGED</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">hwndSource</span> <span class="p">=</span> <span class="n">_hwndSourceTask</span><span class="p">.</span><span class="n">Task</span><span class="p">.</span><span class="n">Result</span><span class="p">;</span>
                        <span class="kt">var</span> <span class="n">bounds</span> <span class="p">=</span> <span class="nf">TransformToAppBar</span><span class="p">(</span><span class="n">hwndSource</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span> <span class="n">_window</span><span class="p">.</span><span class="n">RestoreBounds</span><span class="p">,</span> <span class="n">Edge</span><span class="p">);</span>
                        <span class="nf">Resize</span><span class="p">(</span><span class="n">_window</span><span class="p">,</span> <span class="n">bounds</span><span class="p">);</span>
                        <span class="n">handled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Resize</span><span class="p">(</span><span class="n">Window</span> <span class="n">window</span><span class="p">,</span> <span class="n">Rect</span> <span class="n">bounds</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">window</span><span class="p">.</span><span class="n">Left</span> <span class="p">=</span> <span class="n">bounds</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">Top</span> <span class="p">=</span> <span class="n">bounds</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">bounds</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
                <span class="n">window</span><span class="p">.</span><span class="n">Height</span> <span class="p">=</span> <span class="n">bounds</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="n">Rect</span> <span class="nf">TransformToAppBar</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">Rect</span> <span class="n">area</span><span class="p">,</span> <span class="n">AppBarEdge</span> <span class="n">edge</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">APPBARDATA</span><span class="p">();</span>
                <span class="n">data</span><span class="p">.</span><span class="n">cbSize</span> <span class="p">=</span> <span class="n">Marshal</span><span class="p">.</span><span class="nf">SizeOf</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
                <span class="n">data</span><span class="p">.</span><span class="n">hWnd</span> <span class="p">=</span> <span class="n">hWnd</span><span class="p">;</span>
                <span class="n">data</span><span class="p">.</span><span class="n">uEdge</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">edge</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">uEdge</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Left</span> <span class="p">||</span> <span class="n">data</span><span class="p">.</span><span class="n">uEdge</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Right</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">top</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">bottom</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">SystemParameters</span><span class="p">.</span><span class="n">PrimaryScreenHeight</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">uEdge</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Left</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">left</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">right</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">area</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">right</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">SystemParameters</span><span class="p">.</span><span class="n">PrimaryScreenWidth</span><span class="p">;</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">left</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">right</span> <span class="p">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">area</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">left</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">right</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">SystemParameters</span><span class="p">.</span><span class="n">PrimaryScreenWidth</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">uEdge</span> <span class="p">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">AppBarEdge</span><span class="p">.</span><span class="n">Top</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">top</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">bottom</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">area</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">bottom</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">SystemParameters</span><span class="p">.</span><span class="n">PrimaryScreenHeight</span><span class="p">;</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">top</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">bottom</span> <span class="p">-</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Round</span><span class="p">(</span><span class="n">area</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="nf">SHAppBarMessage</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">ABMsg</span><span class="p">.</span><span class="n">ABM_QUERYPOS</span><span class="p">,</span> <span class="k">ref</span> <span class="n">data</span><span class="p">);</span>
                <span class="nf">SHAppBarMessage</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">ABMsg</span><span class="p">.</span><span class="n">ABM_SETPOS</span><span class="p">,</span> <span class="k">ref</span> <span class="n">data</span><span class="p">);</span>

                <span class="k">return</span> <span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">top</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">right</span> <span class="p">-</span> <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">bottom</span> <span class="p">-</span> <span class="n">data</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">top</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
            <span class="k">private</span> <span class="k">struct</span> <span class="nc">RECT</span>
            <span class="p">{</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">left</span><span class="p">;</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">top</span><span class="p">;</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">right</span><span class="p">;</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">bottom</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="p">[</span><span class="nf">StructLayout</span><span class="p">(</span><span class="n">LayoutKind</span><span class="p">.</span><span class="n">Sequential</span><span class="p">)]</span>
            <span class="k">private</span> <span class="k">struct</span> <span class="nc">APPBARDATA</span>
            <span class="p">{</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">cbSize</span><span class="p">;</span>
                <span class="k">public</span> <span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">;</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">uCallbackMessage</span><span class="p">;</span>
                <span class="k">public</span> <span class="kt">int</span> <span class="n">uEdge</span><span class="p">;</span>
                <span class="k">public</span> <span class="n">RECT</span> <span class="n">rc</span><span class="p">;</span>
                <span class="k">public</span> <span class="k">readonly</span> <span class="n">IntPtr</span> <span class="n">lParam</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">enum</span> <span class="n">ABMsg</span> <span class="p">:</span> <span class="kt">int</span>
            <span class="p">{</span>
                <span class="n">ABM_NEW</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
                <span class="n">ABM_REMOVE</span><span class="p">,</span>
                <span class="n">ABM_QUERYPOS</span><span class="p">,</span>
                <span class="n">ABM_SETPOS</span><span class="p">,</span>
                <span class="n">ABM_GETSTATE</span><span class="p">,</span>
                <span class="n">ABM_GETTASKBARPOS</span><span class="p">,</span>
                <span class="n">ABM_ACTIVATE</span><span class="p">,</span>
                <span class="n">ABM_GETAUTOHIDEBAR</span><span class="p">,</span>
                <span class="n">ABM_SETAUTOHIDEBAR</span><span class="p">,</span>
                <span class="n">ABM_WINDOWPOSCHANGED</span><span class="p">,</span>
                <span class="n">ABM_SETSTATE</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">enum</span> <span class="n">ABNotify</span> <span class="p">:</span> <span class="kt">int</span>
            <span class="p">{</span>
                <span class="n">ABN_STATECHANGE</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
                <span class="n">ABN_POSCHANGED</span><span class="p">,</span>
                <span class="n">ABN_FULLSCREENAPP</span><span class="p">,</span>
                <span class="n">ABN_WINDOWARRANGE</span>
            <span class="p">}</span>

            <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"SHELL32"</span><span class="p">,</span> <span class="n">CallingConvention</span> <span class="p">=</span> <span class="n">CallingConvention</span><span class="p">.</span><span class="n">StdCall</span><span class="p">)]</span>
            <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">uint</span> <span class="nf">SHAppBarMessage</span><span class="p">(</span><span class="kt">int</span> <span class="n">dwMessage</span><span class="p">,</span> <span class="k">ref</span> <span class="n">APPBARDATA</span> <span class="n">pData</span><span class="p">);</span>

            <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"User32.dll"</span><span class="p">,</span> <span class="n">CharSet</span> <span class="p">=</span> <span class="n">CharSet</span><span class="p">.</span><span class="n">Auto</span><span class="p">)]</span>
            <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">int</span> <span class="nf">RegisterWindowMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><hr /><p><strong>参考资料</strong></p><ul><li><a href="https://stackoverflow.com/a/84987/6233938">c# - How do you do AppBar docking (to screen edge, like WinAmp) in WPF? - Stack Overflow</a><li><a href="https://github.com/mgaffigan/WpfAppBar">mgaffigan/WpfAppBar: AppBar implementation for WPF</a><li><a href="https://stackoverflow.com/a/2792047/6233938">.net - How to dock an application in the Windows desktop? - Stack Overflow</a><li><a href="https://www.codeproject.com/Articles/6741/AppBar-using-C">AppBar using C# - CodeProject</a><li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shappbarmessage">SHAppBarMessage function (shellapi.h) - Microsoft Docs</a><li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-registerwindowmessagea">RegisterWindowMessageA function (winuser.h) - Microsoft Docs</a></ul><p> 本文会经常更新，请阅读原文： <a href="/post/dock-window-into-windows-desktop.html">https://blog.walterlv.com/post/dock-window-into-windows-desktop.html</a> ，以避免陈旧错误知识的误导，同时有更好的阅读体验。</p><p> <a rel="知识共享许可协议" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"> <img alt="知识共享许可协议" src="https://blog.walterlv.com/assets/img/by-nc-sa.svg" /> </a></p><p> 本作品采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可。欢迎转载、使用、重新发布，但务必保留文章署名 吕毅 （包含链接： <a href="https://blog.walterlv.com">https://blog.walterlv.com</a> ），不得用于商业目的，基于本文修改后的作品务必以相同的许可发布。如有任何疑问，请 <a href="mailto:walter.lv@qq.com">与我联系 (walter.lv@qq.com)</a> 。</p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="comments-wrapper"> 登录 GitHub 账号进行评论</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性） - walterlv&url=https://blog.walterlv.com/post/dock-window-into-windows-desktop.html" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性） - walterlv&u=https://blog.walterlv.com/post/dock-window-into-windows-desktop.html" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=WPF 使用 AppBar 将窗口停靠在桌面上，让其他程序不占用此窗口的空间（附我封装的附加属性） - walterlv&url=https://blog.walterlv.com/post/dock-window-into-windows-desktop.html" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/post/monitor-foreground-window-on-windows">如何在控制台程序中监听 Windows 前台窗口的变化</a><li><a href="/post/how-to-start-a-process-with-environment-variables-without-code">在 Windows 上如何在启动程序时单独为这个程序指定环境变量，而不需要编写任何代码或脚本</a><li><a href="/post/wpf-draw-a-hsl-hsb-palette-using-hlsl">WPF 像素着色器进阶：使用 HLSL 编写一个高性能的实时变化的 HSL/HSV/HSB 调色盘</a><li><a href="/post/create-wpf-pixel-shader-effects-using-shazzam-shader-editor.html">WPF 像素着色器入门：使用 Shazzam Shader Editor 编写 HLSL 像素着色器代码</a><li><a href="/post/where-is-the-windows-10-native-icons.html">Windows 10 自带那么多图标，去哪里找呢？</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/csharp/">csharp</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wpf/">wpf</a> <a class="post-tag" href="/tags/visualstudio/">visualstudio</a> <a class="post-tag" href="/tags/msbuild/">msbuild</a> <a class="post-tag" href="/tags/uwp/">uwp</a> <a class="post-tag" href="/tags/nuget/">nuget</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/roslyn/">roslyn</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><section class="comments"> <script src="https://utteranc.es/client.js" repo="walterlv/BlogComments" issue-term="pathname" theme="preferred-color-scheme" crossorigin="anonymous" async> </script></section></div></div></div><footer class="d-flex flex-column w-100 justify-content-center"><div id="analytics-box"> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-108101550-1"></script> <script> document.addEventListener("DOMContentLoaded", function (event) { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-108101550-1'); }); </script> <script async type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1264408226'%3E%3C/span%3E%3Cscript src='//s22.cnzz.com/z_stat.php%3Fid%3D1264408226%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script></div><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2014-2024 <a href="https://github.com/walterlv">walterlv</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由吕毅按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，基于 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题修改。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/csharp/">csharp</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/wpf/">wpf</a> <a class="post-tag" href="/tags/visualstudio/">visualstudio</a> <a class="post-tag" href="/tags/msbuild/">msbuild</a> <a class="post-tag" href="/tags/uwp/">uwp</a> <a class="post-tag" href="/tags/nuget/">nuget</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/roslyn/">roslyn</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
